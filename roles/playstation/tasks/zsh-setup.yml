- name: Remove oh-my-zsh plugins and themes
  shell: rm -rf ~/.oh-my-zsh/custom/plugins/* ~/.oh-my-zsh/custom/themes/*
  tags:
    - install
    - zsh
- name: Install Zsh
  ansible.builtin.package: name=zsh
  tags:
    - zsh
#- name: Set default shell for users
#  become: true
#  ansible.builtin.user:
#    name: "{{ user.username }}"
#    shell: "{{ zsh_path }}"
#  with_items: "{{ users }}"
#  when: "((user.oh_my_zsh | default({})).install | default(oh_my_zsh_install)) | bool"
#  loop_control:
#    loop_var: user
#    label: "{{ user.username }}"
# TODO: Source zsh_path as variable
- name: Set zsh as default shell for users
  shell: chsh -s /bin/zsh
  tags:
    - zsh
- name: Install oh-my-zsh if not existing
  shell: >-
    sh -c "$(curl -fsSL
    https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
  args:
    chdir: /opt
    creates: ~/.oh-my-zsh
  tags:
    - zsh
    - oh-my-zsh
- name: Install oh-my-zsh plugin - zsh-autosuggestions
  ansible.builtin.git:
    repo: "https://github.com/zsh-users/zsh-autosuggestions.git"
    dest: "{{ lookup('env', 'HOME') }}/.oh-my-zsh/custom/plugins/zsh-autosuggestions"
  tags:
    - zsh
    - oh-my-zsh
    - plugins
- name: Install oh-my-zsh plugin - zsh-nvm plugin
  ansible.builtin.git:
    repo: "https://github.com/lukechilds/zsh-nvm.git"
    dest: "{{ lookup('env', 'HOME') }}/.oh-my-zsh/custom/plugins/zsh-nvm"
  tags:
    - zsh
    - oh-my-zsh
    - plugins
- name: Install oh-my-zsh theme - spaceship
  ansible.builtin.git:
    repo: "https://github.com/spaceship-prompt/spaceship-prompt.git"
    depth: 1
    dest: "{{ lookup('env', 'HOME') }}/.oh-my-zsh/custom/themes/spaceship-prompt"
  tags:
    - zsh
    - oh-my-zsh
    - themes
